# üõ† MERN Auth-Beispiel mit JWT  üöÄ
 (inkl. Token-Erstellung, Middleware, Login). 
> Backend-Teil (Node + Express + MongoDB + JWT + bcrypt)

Perfekt! üôå Dann machen wir jetzt gemeinsam ein **Mini MERN Auth-Beispiel mit JWT**, Schritt f√ºr Schritt ‚Äì ADHD-freundlich und gut strukturiert. Wir konzentrieren uns erst mal auf den **Backend-Teil (Node + Express + MongoDB + JWT + bcrypt)**.

---

## üîß MERN Auth Flow mit JWT ‚Äì Backend

### üß© Was bauen wir?

‚úÖ Registration
‚úÖ Login
‚úÖ JWT generieren
‚úÖ Middleware zum Token pr√ºfen (`authMiddleware`)
‚úÖ Testroute: `/protected`

---

## üìÅ Ordnerstruktur (minimal)

```
/server
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ User.js
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ authMiddleware.js
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ server.js
‚îî‚îÄ‚îÄ package.json
```

---

## üß∞ Schritt 1: Setup & Pakete installieren

```bash
mkdir server && cd server
npm init -y

npm install express mongoose dotenv bcrypt jsonwebtoken cors
npm install --save-dev nodemon
```

In `package.json`:

```json
"scripts": {
  "dev": "nodemon server.js"
}
```

---

## üß¨ Schritt 2: MongoDB + Express Grundger√ºst

**`server.js`**

```js
require("dotenv").config();
const express = require("express");
const mongoose = require("mongoose");
const cors = require("cors");

const authRoutes = require("./routes/auth");

const app = express();
app.use(cors());
app.use(express.json());

app.use("/api/auth", authRoutes);

mongoose
  .connect(process.env.MONGO_URI)
  .then(() => {
    app.listen(5000, () => console.log("Server running on port 5000"));
  })
  .catch((err) => console.error("Mongo Error:", err));
```

**`.env`**

```
MONGO_URI=mongodb://localhost:27017/jwt-demo
JWT_SECRET=geheimespasswort123
```

---

## üë§ Schritt 3: User Model

**`models/User.js`**

```js
const mongoose = require("mongoose");

const userSchema = new mongoose.Schema({
  username: { type: String, required: true, unique: true },
  password: { type: String, required: true },
});

module.exports = mongoose.model("User", userSchema);
```

---

## üîê Schritt 4: Auth Routes (Register & Login)

**`routes/auth.js`**

```js
const express = require("express");
const bcrypt = require("bcrypt");
const jwt = require("jsonwebtoken");
const User = require("../models/User");

const router = express.Router();

// REGISTER
router.post("/register", async (req, res) => {
  const { username, password } = req.body;

  const exists = await User.findOne({ username });
  if (exists) return res.status(400).json({ message: "User already exists" });

  const hashed = await bcrypt.hash(password, 10);

  const user = new User({ username, password: hashed });
  await user.save();

  res.status(201).json({ message: "User created" });
});

// LOGIN
router.post("/login", async (req, res) => {
  const { username, password } = req.body;

  const user = await User.findOne({ username });
  if (!user) return res.status(400).json({ message: "User not found" });

  const match = await bcrypt.compare(password, user.password);
  if (!match) return res.status(401).json({ message: "Wrong password" });

  const token = jwt.sign(
    { userId: user._id, username: user.username },
    process.env.JWT_SECRET,
    { expiresIn: "1h" }
  );

  res.json({ token });
});

module.exports = router;
```

---

## üõ°Ô∏è Schritt 5: Middleware ‚Äì Auth pr√ºfen

**`middleware/authMiddleware.js`**

```js
const jwt = require("jsonwebtoken");

const authMiddleware = (req, res, next) => {
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith("Bearer "))
    return res.status(401).json({ message: "Token fehlt" });

  const token = authHeader.split(" ")[1];

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (err) {
    res.status(403).json({ message: "Ung√ºltiger Token" });
  }
};

module.exports = authMiddleware;
```

---

## üîê Schritt 6: Gesch√ºtzte Route

In `routes/auth.js` hinzuf√ºgen:

```js
const authMiddleware = require("../middleware/authMiddleware");

router.get("/protected", authMiddleware, (req, res) => {
  res.json({ message: "Gesch√ºtzter Inhalt f√ºr: " + req.user.username });
});
```

---

## ‚úÖ Next: [Frontend](week_two/021_jwt-2_FE.md).

**Frontend-Part**:

* Vite + React App erstellen
* Login/Register UI
* JWT speichern & mit API senden
* Token pr√ºfen & gesch√ºtzte Views

---


